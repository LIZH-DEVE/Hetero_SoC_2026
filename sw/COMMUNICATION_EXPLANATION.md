# SmartNIC é€šä¿¡æ¶æ„è¯¦è§£

## ç›®å½•

1. [äº§å“æ¦‚è¿°](#1-äº§å“æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [ç‰©ç†è¿æ¥](#3-ç‰©ç†è¿æ¥)
4. [é€šä¿¡æµç¨‹](#4-é€šä¿¡æµç¨‹)
5. [ä»£ç ç¤ºä¾‹](#5-ä»£ç ç¤ºä¾‹)
6. [å®Œæ•´é€šä¿¡ç³»ç»Ÿ](#6-å®Œæ•´é€šä¿¡ç³»ç»Ÿ)
7. [å¸¸è§é—®é¢˜](#7-å¸¸è§é—®é¢˜)
8. [å¿«é€Ÿå‚è€ƒ](#8-å¿«é€Ÿå‚è€ƒ)

---

## 1. äº§å“æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯SmartNICï¼Ÿ

**SmartNIC = FPGAç¡¬ä»¶åŠ é€Ÿå¡ + ç½‘ç»œæ¥å£å¡**

å®ƒæ˜¯ä¸€å—ç‹¬ç«‹çš„ç¡¬ä»¶è®¾å¤‡ï¼Œä¸æ˜¯è½¯ä»¶ï¼å…·å¤‡ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸ” ç¡¬ä»¶åŠ å¯† | AES-128-CBC / SM4-CBC |
| âš¡ é«˜æ€§èƒ½ | 950 MB/sååé‡ |
| ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§ | ACLé˜²ç«å¢™ã€DNAç»‘å®š |
| ğŸ’» ä½CPUå ç”¨ | ä»…å¤„ç†æè¿°ç¬¦ |

### 1.2 å…³é”®æ¦‚å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SmartNICæœ‰è‡ªå·±ç‹¬ç«‹çš„:                                       â”‚
â”‚  â€¢ IPåœ°å€: 192.168.1.10 (é»˜è®¤)                              â”‚
â”‚  â€¢ ç«¯å£: 8080                                               â”‚
â”‚  â€¢ é€šè¿‡UDP Socketä¸ä¸Šä½æœºé€šä¿¡                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SmartNIC FPGA                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚         ARM (PS)        â”‚  Linux + é©±åŠ¨                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚       FPGA Logic (PL)   â”‚                                    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”      â”‚                                    â”‚
â”‚  â”‚  â”‚ MAC â”‚  â”‚ ARP â”‚      â”‚                                    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜      â”‚                                    â”‚
â”‚  â”‚     â”‚        â”‚         â”‚                                    â”‚
â”‚  â”‚     â–¼        â”‚         â”‚                                    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”     â”‚         â”‚                                    â”‚
â”‚  â”‚  â”‚ RX  â”‚     â”‚         â”‚                                    â”‚
â”‚  â”‚  â”‚Parserâ”‚     â”‚         â”‚                                    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜     â”‚         â”‚                                    â”‚
â”‚  â”‚     â”‚        â”‚         â”‚                                    â”‚
â”‚  â”‚     â–¼        â”‚         â”‚                                    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”     â”‚         â”‚                                    â”‚
â”‚  â”‚  â”‚ ACL â”‚     â”‚         â”‚                                    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜     â”‚         â”‚                                    â”‚
â”‚  â”‚     â”‚        â”‚         â”‚                                    â”‚
â”‚  â”‚     â–¼        â”‚         â”‚                                    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                    â”‚
â”‚  â”‚  â”‚ Packet Dispatchâ”‚     â”‚                                    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                    â”‚
â”‚  â”‚          â”‚             â”‚                                    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”      â”‚                                    â”‚
â”‚  â”‚   â–¼             â–¼      â”‚                                    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                    â”‚
â”‚  â”‚ â”‚FastPathâ”‚ â”‚ Crypto   â”‚ â”‚                                    â”‚
â”‚  â”‚ â”‚é€šé“   â”‚ â”‚ Engine   â”‚ â”‚                                    â”‚
â”‚  â”‚ â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚                                    â”‚
â”‚  â”‚     â”‚           â”‚        â”‚                                    â”‚
â”‚  â”‚     â”‚           â–¼        â”‚                                    â”‚
â”‚  â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                    â”‚
â”‚  â”‚     â”‚    â”‚  PBM        â”‚ â”‚                                    â”‚
â”‚  â”‚     â”‚    â”‚  Controller â”‚ â”‚                                    â”‚
â”‚  â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚                                    â”‚
â”‚  â”‚     â”‚           â”‚        â”‚                                    â”‚
â”‚  â”‚     â”‚           â–¼        â”‚                                    â”‚
â”‚  â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                    â”‚
â”‚  â”‚     â”‚    â”‚   DMA       â”‚ â”‚                                    â”‚
â”‚  â”‚     â”‚    â”‚   Engine    â”‚ â”‚                                    â”‚
â”‚  â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚                                    â”‚
â”‚  â”‚     â”‚           â”‚        â”‚                                    â”‚
â”‚  â”‚     â”‚           â–¼        â”‚                                    â”‚
â”‚  â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                    â”‚
â”‚  â”‚     â”‚    â”‚   TX Stack  â”‚ â”‚                                    â”‚
â”‚  â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚                                    â”‚
â”‚  â”‚     â”‚           â”‚        â”‚                                    â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚  â”‚                 â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                    â”‚
â”‚           Ethernet (RJ45)
â”‚                    â”‚
â”‚                    â–¼
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚                   ä¸Šä½æœº (PC)                           â”‚
â”‚  â”‚                                                         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  â”‚   Python Application    â”‚                           â”‚
â”‚  â”‚  â”‚   smartnic_driver.py    â”‚                           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â”‚              â”‚                                          â”‚
â”‚  â”‚              â–¼                                          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  â”‚      UDP Socket         â”‚                           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµå›¾

```
æ•°æ®åŠ å¯†å®Œæ•´æµç¨‹:

ã€æ­¥éª¤1: é…ç½®ã€‘
PC â”€â”€UDP (0x4321)â”€â”€â–º SmartNIC
    é…ç½®åŒ…: Magic + ç®—æ³• + å¯†é’¥ + IV
â—„â”€â”€ å“åº”

ã€æ­¥éª¤2: åŠ å¯†ã€‘
PC â”€â”€UDP (0x1234)â”€â”€â–º SmartNIC
    æ˜æ–‡æ•°æ®åŒ…
â—„â”€â”€ å¯†æ–‡å“åº”

ã€æ­¥éª¤3: ä¼ è¾“ã€‘
PC â”€â”€UDPâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ç›®æ ‡ä¸»æœº
    å¯†æ–‡æ•°æ®
```

### 2.3 ç«¯å£å®šä¹‰

| åç§° | ç«¯å£(åè¿›åˆ¶) | åŠŸèƒ½ |
|------|-------------|------|
| Config | 17185 | åŠ å¯†é…ç½® |
| Crypto | 4660 | åŠ å¯†æ•°æ®ä¼ è¾“ |
| Data | 22136 | FastPathé€ä¼  |
| Status | 4096 | çŠ¶æ€æŸ¥è¯¢ |

### 2.4 æ•°æ®åŒ…æ ¼å¼

**é…ç½®åŒ… (ç«¯å£ 17185):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Magic  â”‚ seq_id â”‚ algo   â”‚ Key (16B)      â”‚ IV (16B)       â”‚
â”‚  4B    â”‚  2B    â”‚  1B    â”‚                â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚        â”‚        â”‚            â”‚                â”‚
   â”‚        â”‚        â”‚            â”‚                â””â”€â”€ åˆå§‹åŒ–å‘é‡
   â”‚        â”‚        â”‚            â””â”€â”€ åŠ å¯†å¯†é’¥
   â”‚        â”‚        â””â”€â”€ 0=AES, 1=SM4
   â””â”€â”€ 0xDEADBEEF
```

**åŠ å¯†åŒ… (ç«¯å£ 4660):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚src_port â”‚dst_port â”‚ length  â”‚ Payload (16Bå¯¹é½)    â”‚
â”‚   2B    â”‚   2B    â”‚   2B    â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç‰©ç†è¿æ¥

### 3.1 è¿æ¥æ–¹å¼

**æ–¹å¼1: ç›´è¿ (æ¨èç”¨äºæµ‹è¯•)**

```
PC (192.168.1.100) â—„â”€â”€â”€â”€â”€â–º SmartNIC (192.168.1.10)
        â”‚                        â”‚
        â”‚    ç›´è¿ç½‘çº¿            â”‚
        â”‚                        â”‚
        â–¼                        â–¼
    USBè½¬JTAG              çƒ§å½•/è°ƒè¯•
```

**æ–¹å¼2: é€šè¿‡äº¤æ¢æœº (ç”Ÿäº§ç¯å¢ƒ)**

```
PC (192.168.1.100) â—„â”€â”€â”€â”€â”€â–º äº¤æ¢æœº â—„â”€â”€â”€â”€â”€â–º SmartNIC (192.168.1.10)
                                    â”‚
                                    â–¼
                            å…¶ä»–PC/æœåŠ¡å™¨
```

### 3.2 IPé…ç½®

| è®¾å¤‡ | IPåœ°å€ | å­ç½‘æ©ç  |
|------|--------|----------|
| SmartNIC | 192.168.1.10 | 255.255.255.0 |
| PC | 192.168.1.x | 255.255.255.0 |

**Windowsé…ç½®:**
```
æ§åˆ¶é¢æ¿ â†’ ç½‘ç»œå’Œå…±äº«ä¸­å¿ƒ â†’ æ›´æ”¹é€‚é…å™¨è®¾ç½®
â†’ ä»¥å¤ªç½‘å±æ€§ â†’ TCP/IPv4
â†’ ä½¿ç”¨ä»¥ä¸‹IPåœ°å€:
  IPåœ°å€: 192.168.1.100
  å­ç½‘æ©ç : 255.255.255.0
```

**Linuxé…ç½®:**
```bash
sudo ip addr add 192.168.1.100/24 dev eth0
sudo ip link set eth0 up
```

---

## 4. é€šä¿¡æµç¨‹

### 4.1 å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é€šä¿¡æµç¨‹                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€é˜¶æ®µ1: åˆå§‹åŒ–ã€‘

   ä¸Šä½æœº                          SmartNIC
      â”‚
      â”‚  1. åˆ›å»ºUDP Socket
      â”‚  2. connect(SMARTNIC)
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚     è¿æ¥ç¡®è®¤              â”‚


ã€é˜¶æ®µ2: é…ç½®ã€‘

   ä¸Šä½æœº                          SmartNIC
      â”‚
      â”‚  3. é€‰æ‹©åŠ å¯†ç®—æ³•
      â”‚     set_aes() / set_sm4()
      â”‚
      â”‚  4. å‘é€é…ç½®åŒ…
      â”‚     Magic + Algo + Key + IV
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                           â”‚ è§£æé…ç½®
      â”‚                           â”‚ è®¾ç½®å¯†é’¥
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚     é…ç½®å“åº”              â”‚


ã€é˜¶æ®µ3: åŠ å¯†å‘é€ã€‘

   ä¸Šä½æœº                          SmartNIC                    ç½‘ç»œ
      â”‚                              â”‚                          â”‚
      â”‚  5. å‡†å¤‡æ˜æ–‡æ•°æ®              â”‚                          â”‚
      â”‚     (16å­—èŠ‚å¯¹é½)              â”‚                          â”‚
      â”‚                              â”‚                          â”‚
      â”‚  6. è°ƒç”¨encrypt()            â”‚                          â”‚
      â”‚                              â”‚                          â”‚
      â”‚  7. å‘é€åŠ å¯†è¯·æ±‚              â”‚                          â”‚
      â”‚     æ•°æ®åŒ…                   â”‚                          â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
      â”‚                              â”‚ åŠ å¯†å¤„ç†                 â”‚
      â”‚                              â”‚                          â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
      â”‚  8. æ¥æ”¶å¯†æ–‡å“åº”              â”‚                          â”‚
      â”‚                              â”‚                          â”‚
      â”‚  9. å‘é€åˆ°ç½‘ç»œ                â”‚                          â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                              â”‚                    ç›®æ ‡ä¸»æœº


ã€é˜¶æ®µ4: æ¥æ”¶è§£å¯†ã€‘

   ä¸Šä½æœº                          SmartNIC                    ç½‘ç»œ
      â”‚                              â”‚                          â”‚
      â”‚ 10. åˆ›å»ºç›‘å¬Socket           â”‚                          â”‚
      â”‚     bind(0.0.0.0, port)      â”‚                          â”‚
      â”‚                              â”‚                          â”‚
      â”‚ 11. æ¥æ”¶ç½‘ç»œæ•°æ®             â”‚                          â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚     UDP Datagram             â”‚                  ç›®æ ‡ä¸»æœº
      â”‚                              â”‚                          â”‚
      â”‚ 12. è°ƒç”¨decrypt()            â”‚                          â”‚
      â”‚                              â”‚                          â”‚
      â”‚ 13. å‘é€è§£å¯†è¯·æ±‚             â”‚                          â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
      â”‚                              â”‚ è§£å¯†å¤„ç†                 â”‚
      â”‚                              â”‚                          â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
      â”‚ 14. æ¥æ”¶æ˜æ–‡å“åº”              â”‚                          â”‚
```

---

## 5. ä»£ç ç¤ºä¾‹

### 5.1 æœ€ç®€ç¤ºä¾‹

```python
#!/usr/bin/env python3
"""
SmartNIC æœ€ç®€ä½¿ç”¨ç¤ºä¾‹
"""

from smartnic_driver import SmartNICDriver

# 1. åˆ›å»ºé©±åŠ¨
driver = SmartNICDriver()

# 2. è¿æ¥SmartNIC
driver.connect()

# 3. é€‰æ‹©åŠ å¯†æ–¹å¼
driver.set_aes()   # AES-128-CBC
# driver.set_sm4() # SM4-CBC

# 4. åŠ å¯†æ•°æ®
plaintext = b"Hello, SmartNIC!"  # 17å­—èŠ‚ï¼Œä¼šè‡ªåŠ¨å¡«å……åˆ°32å­—èŠ‚
ciphertext = driver.encrypt(plaintext)

print(f"åŸæ–‡: {plaintext}")
print(f"å¯†æ–‡: {ciphertext.hex()}")

# 5. æ–­å¼€è¿æ¥
driver.disconnect()
```

### 5.2 å‘é€ç«¯ç¤ºä¾‹

```python
#!/usr/bin/env python3
"""
SmartNIC å‘é€ç«¯ç¤ºä¾‹
åŠ å¯†æ•°æ®å¹¶å‘é€åˆ°ç½‘ç»œ
"""

import socket
from smartnic_driver import SmartNICDriver

# é…ç½®
SMARTNIC_IP = '192.168.1.10'
SMARTNIC_PORT = 8080
TARGET_IP = '192.168.1.200'  # ç›®æ ‡ç”µè„‘IP
TARGET_PORT = 9000           # ç›®æ ‡ç«¯å£

def main():
    print("="*60)
    print("SmartNIC å‘é€ç«¯")
    print("="*60)
    
    # 1. åˆ›å»ºé©±åŠ¨
    driver = SmartNICDriver(
        smartnic_ip=SMARTNIC_IP,
        smartnic_port=SMARTNIC_PORT
    )
    
    # 2. è¿æ¥SmartNIC
    print("\n[1/5] è¿æ¥SmartNIC...")
    if not driver.connect():
        print("âŒ è¿æ¥å¤±è´¥")
        return
    print("âœ… è¿æ¥æˆåŠŸ")
    
    # 3. é…ç½®åŠ å¯†
    print("[2/5] é…ç½®åŠ å¯†...")
    driver.set_aes()
    print("âœ… é…ç½®å®Œæˆ")
    
    # 4. å‡†å¤‡æ•°æ®
    print("[3/5] å‡†å¤‡æ•°æ®...")
    message = input("è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯: ").strip()
    if not message:
        message = "Hello from SmartNIC!"
    plaintext = message.encode('utf-8')
    print(f"åŸæ–‡: {plaintext}")
    
    # 5. åŠ å¯†å¹¶å‘é€
    print("[4/5] åŠ å¯†...")
    ciphertext = driver.encrypt(plaintext)
    if not ciphertext:
        print("âŒ åŠ å¯†å¤±è´¥")
        driver.disconnect()
        return
    print(f"âœ… åŠ å¯†å®Œæˆ: {len(plaintext)} -> {len(ciphertext)} å­—èŠ‚")
    
    print("[5/5] å‘é€åˆ°ç½‘ç»œ...")
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.sendto(ciphertext, (TARGET_IP, TARGET_PORT))
    print(f"âœ… å·²å‘é€è‡³ {TARGET_IP}:{TARGET_PORT}")
    
    # å®Œæˆ
    print("\n" + "-"*60)
    print("å‘é€å®Œæˆ!")
    driver.disconnect()

if __name__ == '__main__':
    main()
```

### 5.3 æ¥æ”¶ç«¯ç¤ºä¾‹

```python
#!/usr/bin/env python3
"""
SmartNIC æ¥æ”¶ç«¯ç¤ºä¾‹
ç›‘å¬ç½‘ç»œç«¯å£ï¼Œæ¥æ”¶æ•°æ®å¹¶è§£å¯†
"""

import socket
from smartnic_driver import SmartNICDriver

# é…ç½®
SMARTNIC_IP = '192.168.1.10'
SMARTNIC_PORT = 8080
LISTEN_PORT = 9000

def main():
    print("="*60)
    print("SmartNIC æ¥æ”¶ç«¯")
    print("="*60)
    
    # 1. åˆ›å»ºé©±åŠ¨
    driver = SmartNICDriver(
        smartnic_ip=SMARTNIC_IP,
        smartnic_port=SMARTNIC_PORT
    )
    
    # 2. è¿æ¥
    print("\n[1/4] è¿æ¥SmartNIC...")
    if not driver.connect():
        print("âŒ è¿æ¥å¤±è´¥")
        return
    print("âœ… è¿æ¥æˆåŠŸ")
    
    # 3. é…ç½®åŠ å¯† (å¿…é¡»ä¸å‘é€ç«¯ä¸€è‡´!)
    print("[2/4] é…ç½®åŠ å¯† (å¿…é¡»ä¸å‘é€ç«¯ä¸€è‡´)...")
    driver.set_aes()
    print("âœ… é…ç½®å®Œæˆ")
    
    # 4. ç›‘å¬
    print(f"\n[3/4] å¼€å§‹ç›‘å¬ç«¯å£ {LISTEN_PORT}...")
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    sock.bind(('0.0.0.0', LISTEN_PORT))
    sock.settimeout(0.5)  # æ”¯æŒCtrl+Cé€€å‡º
    
    print(f"âœ… ç›‘å¬ä¸­... (æŒ‰Ctrl+Cåœæ­¢)")
    
    try:
        while True:
            try:
                # æ¥æ”¶æ•°æ®
                data, addr = sock.recvfrom(65535)
                print(f"\nğŸ“¥ æ”¶åˆ°æ¥è‡ª {addr[0]}:{addr[1]}")
                print(f"   æ•°æ®é•¿åº¦: {len(data)} å­—èŠ‚")
                
                # è§£å¯†
                print("   è§£å¯†ä¸­...")
                plaintext = driver.decrypt(data)
                
                if plaintext:
                    print(f"âœ… è§£å¯†æˆåŠŸ!")
                    print(f"   æ˜æ–‡: {plaintext.decode('utf-8', errors='ignore')}")
                else:
                    print("âŒ è§£å¯†å¤±è´¥")
                
                print("\n   ç»§ç»­ç›‘å¬...")
                
            except socket.timeout:
                continue
                
    except KeyboardInterrupt:
        print("\n\nåœæ­¢ç›‘å¬")
    
    driver.disconnect()
    print("\nå®Œæˆ!")

if __name__ == '__main__':
    main()
```

---

## 6. å®Œæ•´é€šä¿¡ç³»ç»Ÿ

### 6.1 ä¸¤å°ç”µè„‘é€šä¿¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸¤å°ç”µè„‘é€šä¿¡æ¶æ„                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”µè„‘A (å‘é€ç«¯)                      ç”µè„‘B (æ¥æ”¶ç«¯)
192.168.1.100              192.168.1.200
    â”‚                           â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
    â”‚  â”‚ SmartNIC    â”‚          â”‚
    â”‚  â”‚ é©±åŠ¨        â”‚          â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
    â”‚         â”‚                 â”‚
    â”‚         â–¼                 â”‚
    â”‚  UDP Socket               â”‚
    â”‚  sendto()                 â”‚
    â”‚         â”‚                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ UDPç½‘ç»œ
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SmartNIC (192.168.1.10)â”‚
    â”‚  åŠ å¯†/è§£å¯†å¤„ç†          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 é€šä¿¡æ­¥éª¤

**ç”µè„‘A (å‘é€ç«¯) æ“ä½œ:**

```python
# 1. è¿æ¥SmartNIC
driver = SmartNICDriver()
driver.connect()
driver.set_aes()

# 2. åŠ å¯†æ•°æ®
plaintext = b"è¦å‘é€çš„æ¶ˆæ¯"
ciphertext = driver.encrypt(plaintext)

# 3. å‘é€åˆ°ç”µè„‘B
import socket
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sock.sendto(ciphertext, ('192.168.1.200', 9000))
```

**ç”µè„‘B (æ¥æ”¶ç«¯) æ“ä½œ:**

```python
# 1. è¿æ¥SmartNIC
driver = SmartNICDriver()
driver.connect()
driver.set_aes()  # å¿…é¡»ä¸å‘é€ç«¯ç›¸åŒ!

# 2. ç›‘å¬ç«¯å£
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sock.bind(('0.0.0.0', 9000))

# 3. æ¥æ”¶å¹¶è§£å¯†
data, addr = sock.recvfrom(65535)
plaintext = driver.decrypt(data)
print(plaintext.decode())
```

---

## 7. å¸¸è§é—®é¢˜

### Q1: è¿æ¥å¤±è´¥

```python
# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
import subprocess
result = subprocess.run(['ping', '192.168.1.10'], capture_output=True)
if 'å›å¤' not in result.stdout:
    print("æ— æ³•pingé€šSmartNICï¼Œè¯·æ£€æŸ¥:")
    print("1. SmartNICæ˜¯å¦å·²å¼€æœº")
    print("2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸")
    print("3. IPåœ°å€æ˜¯å¦æ­£ç¡®")
```

### Q2: åŠ å¯†å¤±è´¥

```python
# æ£€æŸ¥1: è¿æ¥çŠ¶æ€
if not driver.sock:
    driver.connect()

# æ£€æŸ¥2: åŠ å¯†é…ç½®
driver.set_aes()  # é‡æ–°é…ç½®

# æ£€æŸ¥3: æ•°æ®æ ¼å¼ (å¿…é¡»æ˜¯16å­—èŠ‚æ•´æ•°å€)
if len(plaintext) % 16 != 0:
    plaintext = plaintext.ljust(((len(plaintext)+15)//16)*16, b'\x00')
```

### Q3: åŠ å¯†ç»“æœä¸æ­£ç¡®

```python
# æ£€æŸ¥: å¯†é’¥å’ŒIVä¸€è‡´æ€§
print("å½“å‰å¯†é’¥:", driver.config['key'].hex())
print("å½“å‰IV:", driver.config['iv'].hex())

# ç¡®ä¿å‘é€ç«¯å’Œæ¥æ”¶ç«¯ä½¿ç”¨ç›¸åŒé…ç½®
```

### Q4: æ¥æ”¶ä¸åˆ°æ•°æ®

```python
# æ£€æŸ¥1: é˜²ç«å¢™ - å¼€æ”¾UDPç«¯å£9000

# æ£€æŸ¥2: IPé…ç½® - ç¡®ä¿ç›®æ ‡IPæ­£ç¡®

# æ£€æŸ¥3: è¶…æ—¶è®¾ç½®
sock.settimeout(5)  # è®¾ç½®5ç§’è¶…æ—¶
```

---

## 8. å¿«é€Ÿå‚è€ƒ

### 8.1 å¸¸ç”¨é…ç½®

| é¡¹ç›® | å€¼ |
|------|-----|
| SmartNIC IP | 192.168.1.10 |
| SmartNIC ç«¯å£ | 8080 |
| åŠ å¯†ç®—æ³• | AES-128-CBC / SM4-CBC |
| é»˜è®¤å¯†é’¥(AES) | 2b7e151628aed2a6abf7158809cf4f3c |
| é»˜è®¤å¯†é’¥(SM4) | 0123456789abcdeffedcba9876543210 |

### 8.2 APIé€ŸæŸ¥

```python
# åˆ›å»ºé©±åŠ¨
driver = SmartNICDriver(ip, port)

# è¿æ¥/æ–­å¼€
driver.connect()
driver.disconnect()

# é…ç½®åŠ å¯†
driver.set_aes()
driver.set_sm4()

# åŠ å¯†/è§£å¯†
ciphertext = driver.encrypt(plaintext)
plaintext = driver.decrypt(ciphertext)
```

### 8.3 å®Œæ•´æµç¨‹

```
1. å¯¼å…¥æ¨¡å—: from smartnic_driver import SmartNICDriver
2. åˆ›å»ºé©±åŠ¨: driver = SmartNICDriver()
3. è¿æ¥: driver.connect()
4. é…ç½®: driver.set_aes() æˆ– set_sm4()
5. åŠ å¯†: ciphertext = driver.encrypt(plaintext)
6. å‘é€: sock.sendto(ciphertext, (ip, port))
7. æ¥æ”¶: data, addr = sock.recvfrom(65535)
8. è§£å¯†: plaintext = driver.decrypt(data)
9. æ–­å¼€: driver.disconnect()
```

---

## æ–‡ä»¶æ¸…å•

```
sw/
â”œâ”€â”€ smartnic_driver.py              # ä¸»é©±åŠ¨ (å¿…å¤‡)
â”œâ”€â”€ simple_communication.py         # ç®€åŒ–ç¤ºä¾‹ (æ¨èå…ˆçœ‹)
â”œâ”€â”€ end_to_end_communication.py     # å®Œæ•´é€šä¿¡ç³»ç»Ÿ
â”œâ”€â”€ COMMUNICATION_EXPLANATION.md    # æœ¬æ–‡æ¡£
â””â”€â”€ COMPLETE_USER_MANUAL.md         # å®Œæ•´æ‰‹å†Œ
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2026-01-31  
**é€‚ç”¨ç‰ˆæœ¬**: SmartNIC v1.0+
